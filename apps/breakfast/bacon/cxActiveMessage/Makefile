COMPONENT=TestAppC

#CFLAGS+=-DDEBUG_TASK

ROUND_THRESH_LOG2?=1
CFLAGS+=-DROUND_THRESH_LOG2=$(ROUND_THRESH_LOG2)

#NOTE: to specify from command line:
# TEST_DESC=\\\"TEST_INFO\\\"
TEST_DESC?=\"NO_INFO\"
CFLAGS+=-DTEST_DESC=$(TEST_DESC)

VERBOSE_DUTY_CYCLE?=1
CFLAGS+=-DVERBOSE_DUTY_CYCLE=$(VERBOSE_DUTY_CYCLE)

#TX_START_DELAY?=(5UL*60UL*1024UL)
TX_START_DELAY?=0
CFLAGS+=-DTX_START_DELAY=$(TX_START_DELAY)

#CFLAGS+=-fno-inline
#
WAIT_FOR_PACKET?=1
CFLAGS += -DWAIT_FOR_PACKET=$(WAIT_FOR_PACKET)

CFLAGS+=-DTOSH_DATA_LENGTH=54
PFLAGS+=-I.

TEST_IPI?=61440UL
CFLAGS += -DTEST_IPI=$(TEST_IPI)

CX_MESSAGE_POOL_SIZE?=1
CFLAGS+=-DCX_MESSAGE_POOL_SIZE=$(CX_MESSAGE_POOL_SIZE)
STACK_PROTECTION?=1
CFLAGS+= -DSTACK_PROTECTION=$(STACK_PROTECTION)

CX_ROUTING_TABLE_ENTRIES?=16
CFLAGS+=-DCX_ROUTING_TABLE_ENTRIES=$(CX_ROUTING_TABLE_ENTRIES)

TEST_CHANNEL?=0
CFLAGS+=-DTEST_CHANNEL=$(TEST_CHANNEL)

IS_SENDER?=0
CFLAGS+=-DIS_SENDER=$(IS_SENDER)

TEST_DEST_ADDR?=0xffff
CFLAGS+=-DTEST_DEST_ADDR=$(TEST_DEST_ADDR)

TEST_REQUEST_ACK?=0
CFLAGS+=-DTEST_REQUEST_ACK=$(TEST_REQUEST_ACK)

RF1A_FEC_ENABLED?=1
CFLAGS+=-DRF1A_FEC_ENABLED=$(RF1A_FEC_ENABLED)
FEC_HAMMING74?=1
CFLAGS+=-DFEC_HAMMING74=$(FEC_HAMMING74)

INCLUDE_UNRELIABLE_BURST?=1
CFLAGS+=-DINCLUDE_UNRELIABLE_BURST=$(INCLUDE_UNRELIABLE_BURST)

CX_ENABLE_SKEW_CORRECTION?=1
CFLAGS+=-DCX_ENABLE_SKEW_CORRECTION=$(CX_ENABLE_SKEW_CORRECTION)

INCLUDE_RELIABLE_BURST?=0
CFLAGS+=-DINCLUDE_RELIABLE_BURST=$(INCLUDE_RELIABLE_BURST)

STATIC_FIRST_IDLE_SLOT?=48
CFLAGS+=-DSTATIC_FIRST_IDLE_SLOT=$(STATIC_FIRST_IDLE_SLOT)

STATIC_SCHEDULER?=1
CFLAGS+=-DSTATIC_SCHEDULER=$(STATIC_SCHEDULER)

MAX_ANNOUNCED_SLOTS?=10
CFLAGS+=-DMAX_ANNOUNCED_SLOTS=$(MAX_ANNOUNCED_SLOTS)

CX_BUFFER_WIDTH?=0
CFLAGS+=-DCX_BUFFER_WIDTH=$(CX_BUFFER_WIDTH)

CX_DUTY_CYCLE_ENABLED?=0
CFLAGS+=-DCX_DUTY_CYCLE_ENABLED=$(CX_DUTY_CYCLE_ENABLED)

#0 = drop no packets, 0xff = drop all packets
FWD_DROP_RATE?=0
CFLAGS+=-DFWD_DROP_RATE=$(FWD_DROP_RATE)

CX_FORWARDER_SELECTION?=0
CFLAGS+=-DCX_FORWARDER_SELECTION=$(CX_FORWARDER_SELECTION)

RSSI_THRESHOLD?=-100
CFLAGS+=-DRSSI_THRESHOLD=$(RSSI_THRESHOLD)

MINIMAL_PACKET?=0
CFLAGS+=-DMINIMAL_PACKET=$(MINIMAL_PACKET)

CX_RECORD_EVENTS?=1
CFLAGS+=-DCX_RECORD_EVENTS=$(CX_RECORD_EVENTS)

#dbm patable0
# -30 0x03
# -12 0x25
#  -6 0x2D
#   0 0x8D
#  10 0xC3
# max 0xC0
PATABLE0_SETTING?=0x8D
CFLAGS+=-DPATABLE0_SETTING=$(PATABLE0_SETTING)

TESTBED_START_TIME?=1024UL
CFLAGS+=-DTESTBED_START_TIME=$(TESTBED_START_TIME)

DESKTOP_START_TIME?=10UL*1024UL
CFLAGS+=-DDESKTOP_START_TIME=$(DESKTOP_START_TIME)

DESKTOP_TEST?=0
CFLAGS+=-DDESKTOP_TEST=$(DESKTOP_TEST)

PFLAGS += -I$(TOSDIR)/lib/serialprintf
CFLAGS += -I../../util
CFLAGS += -I../../util/stackGuard
CFLAGS += -I../../util/crc
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/ieee154
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/timer
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/schedule
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/link
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/tdma
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/network
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/network/flood
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/network/scopedFlood
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/transport
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/transport/simpleFlood
#CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/transport/unreliableBurst
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/transport/nsfUnreliableBurst
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/transport/reliableBurst
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/dispatch
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/packet
#CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/physical
#CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/physical/configs
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/routing
CFLAGS += -I$(TOSDIR)/lib/rf1a-tdma/am

CX_RADIO_LOGGING?=0
CFLAGS+=-DCX_RADIO_LOGGING=$(CX_RADIO_LOGGING)


DEBUG_SW_TOPO?=0
CFLAGS += -DDEBUG_SW_TOPO=$(DEBUG_SW_TOPO)
DEBUG_DUP?=0
CFLAGS += -DDEBUG_DUP=$(DEBUG_DUP)
DEBUG_TESTBED_RESOURCE?=0
CFLAGS += -DDEBUG_TESTBED_RESOURCE=$(DEBUG_TESTBED_RESOURCE)

CX_ADAPTIVE_SR?=0
CFLAGS+=-DCX_ADAPTIVE_SR=$(CX_ADAPTIVE_SR)

ENABLE_SKEW_CORRECTION?=0
CFLAGS+=-DENABLE_SKEW_CORRECTION=$(ENABLE_SKEW_CORRECTION)

TDMA_ROOT?=0
CFLAGS+=-DTDMA_ROOT=$(TDMA_ROOT)

DESTINATION_ID?=0
CFLAGS+=-DDESTINATION_ID=$(DESTINATION_ID)

DISCONNECTED_SR?=500
CFLAGS+=-DDISCONNECTED_SR=$(DISCONNECTED_SR)

SCHED_FRAMES_PER_SLOT?=10
CFLAGS+= -DSCHED_FRAMES_PER_SLOT=$(SCHED_FRAMES_PER_SLOT)
SCHED_MAX_DEPTH?=8UL
CFLAGS+= -DSCHED_MAX_DEPTH=$(SCHED_MAX_DEPTH)
SCHED_MAX_RETRANSMIT?=1UL
CFLAGS+= -DSCHED_MAX_RETRANSMIT=$(SCHED_MAX_RETRANSMIT)
SCHED_NUM_SLOTS?=10
CFLAGS+= -DSCHED_NUM_SLOTS=$(SCHED_NUM_SLOTS)
SCHED_INIT_SYMBOLRATE?=125
CFLAGS+= -DSCHED_INIT_SYMBOLRATE=$(SCHED_INIT_SYMBOLRATE)
SCHED_TIMEOUT_CYCLES?=10UL
CFLAGS+= -DSCHED_TIMEOUT_CYCLES=$(SCHED_TIMEOUT_CYCLES)
CX_FIXED_LEN?=0
CFLAGS+=-DCX_FIXED_LEN=$(CX_FIXED_LEN)
CX_SNIFF_ENABLED?=0
CFLAGS+=-DCX_SNIFF_ENABLED=$(CX_SNIFF_ENABLED)

#SchedulerDebug.h
DEBUG_TESTBED_SCHED_NEW?=0
CFLAGS += -DDEBUG_TESTBED_SCHED_NEW=$(DEBUG_TESTBED_SCHED_NEW)
DEBUG_TESTBED_SCHED_ALL?=0
CFLAGS += -DDEBUG_TESTBED_SCHED_ALL=$(DEBUG_TESTBED_SCHED_ALL)
DEBUG_TESTBED_SCHED?=0
CFLAGS += -DDEBUG_TESTBED_SCHED=$(DEBUG_TESTBED_SCHED)
DEBUG_TESTBED?=0
CFLAGS += -DDEBUG_TESTBED=$(DEBUG_TESTBED)
DEBUG_TESTBED_CRC?=0
CFLAGS += -DDEBUG_TESTBED_CRC=$(DEBUG_TESTBED_CRC)
DEBUG_SCHED?=0
CFLAGS += -DDEBUG_SCHED=$(DEBUG_SCHED)
DEBUG_SCHED_IO?=0
CFLAGS += -DDEBUG_SCHED_IO=$(DEBUG_SCHED_IO)
DEBUG_SCHED_SR?=0
CFLAGS += -DDEBUG_SCHED_SR=$(DEBUG_SCHED_SR)
DEBUG_TIMING?=0
CFLAGS += -DDEBUG_TIMING=$(DEBUG_TIMING)
DEBUG_SCHED_RXTX?=1
CFLAGS += -DDEBUG_SCHED_RXTX=$(DEBUG_SCHED_RXTX)

#CXTDMADebug.h
DEBUG_TDMA_SS?=0
CFLAGS += -DDEBUG_TDMA_SS=$(DEBUG_TDMA_SS)
DEBUG_PFS?=0
CFLAGS += -DDEBUG_PFS=$(DEBUG_PFS)
DEBUG_PFS_FREAKOUT?=0
CFLAGS += -DDEBUG_PFS_FREAKOUT=$(DEBUG_PFS_FREAKOUT)
DEBUG_PHY_TIME?=0
CFLAGS += -DDEBUG_PHY_TIME=$(DEBUG_PHY_TIME)
DEBUG_RADIO_STATS?=0
CFLAGS += -DDEBUG_RADIO_STATS=$(DEBUG_RADIO_STATS)
DEBUG_SYNCH_ADJUST?=0
CFLAGS += -DDEBUG_SYNCH_ADJUST=$(DEBUG_SYNCH_ADJUST)
DEBUG_CONFIG?=0
CFLAGS += -DDEBUG_CONFIG=$(DEBUG_CONFIG)
DEBUG_RXREADY_ERROR?=0
CFLAGS += -DDEBUG_RXREADY_ERROR=$(DEBUG_RXREADY_ERROR)
DEBUG_LINK_RXTX?=0
CFLAGS += -DDEBUG_LINK_RXTX=$(DEBUG_LINK_RXTX)

#FDebug.h
DEBUG_F_TESTBED?=0
CFLAGS+=-DDEBUG_F_TESTBED=$(DEBUG_F_TESTBED)
DEBUG_F_STATE?=0
CFLAGS+=-DDEBUG_F_STATE=$(DEBUG_F_STATE)
DEBUG_F_RX?=0
CFLAGS+=-DDEBUG_F_RX=$(DEBUG_F_RX)
DEBUG_F_SCHED?=0
CFLAGS+=-DDEBUG_F_SCHED=$(DEBUG_F_SCHED)
DEBUG_F_GP?=0
CFLAGS+=-DDEBUG_F_GP=$(DEBUG_F_GP)
DEBUG_F_SV?=0
CFLAGS+=-DDEBUG_F_SV=$(DEBUG_F_SV)
DEBUG_F_CLEARTIME?=0
CFLAGS+=-DDEBUG_F_CLEARTIME=$(DEBUG_F_CLEARTIME)


#CXRoutingDebug.h
DEBUG_ROUTING_TABLE?=0
CFLAGS += -DDEBUG_ROUTING_TABLE=$(DEBUG_ROUTING_TABLE)

#SFDebug.h
DEBUG_SF_TESTBED_AW?=0
CFLAGS+=-DDEBUG_SF_TESTBED_AW=$(DEBUG_SF_TESTBED_AW)
DEBUG_SF_TESTBED_PR?=0
CFLAGS+=-DDEBUG_SF_TESTBED_PR=$(DEBUG_SF_TESTBED_PR)
DEBUG_SF_TESTBED?=0
CFLAGS+=-DDEBUG_SF_TESTBED=$(DEBUG_SF_TESTBED)
DEBUG_SF_STATE?=0
CFLAGS+=-DDEBUG_SF_STATE=$(DEBUG_SF_STATE)
DEBUG_SF_GP?=0
CFLAGS+=-DDEBUG_SF_GP=$(DEBUG_SF_GP)
DEBUG_SF_RX?=0
CFLAGS+=-DDEBUG_SF_RX=$(DEBUG_SF_RX)
DEBUG_SF_SV?=0
CFLAGS+=-DDEBUG_SF_SV=$(DEBUG_SF_SV)
DEBUG_SF_ROUTE?=0
CFLAGS+=-DDEBUG_SF_ROUTE=$(DEBUG_SF_ROUTE)
DEBUG_SF_CLEARTIME?=0
CFLAGS+=-DDEBUG_SF_CLEARTIME=$(DEBUG_SF_CLEARTIME)

#CFLAGS += -DDEBUG_CX_TDMA_P_STATE
CFLAGS += -DDEBUG_CX_TDMA_P_STATE_ERROR
#CFLAGS += -DDEBUG_CX_TDMA_P_STATE_IDLE

#AODVDebug.h
DEBUG_AODV?=0
CFLAGS += -DDEBUG_AODV=$(DEBUG_AODV)
DEBUG_AODV_IO?=0
CFLAGS += -DDEBUG_AODV_IO=$(DEBUG_AODV_IO)
DEBUG_AODV_S?=0
CFLAGS += -DDEBUG_AODV_S=$(DEBUG_AODV_S)
DEBUG_AODV_STATE?=0
CFLAGS += -DDEBUG_AODV_STATE=$(DEBUG_AODV_STATE)
DEBUG_AODV_CLEAR?=0
CFLAGS += -DDEBUG_AODV_CLEAR=$(DEBUG_AODV_CLEAR)

#CXPacketDebug.h
DEBUG_PACKET?=0
CFLAGS += -DDEBUG_PACKET=$(DEBUG_PACKET)

#test.h
DEBUG_APP?=1
CFLAGS += -DDEBUG_APP=$(DEBUG_APP)
DEBUG_TEST_QUEUE?=0
CFLAGS += -DDEBUG_TEST_QUEUE=$(DEBUG_TEST_QUEUE)
DEBUG_TMP?=1
CFLAGS += -DDEBUG_TMP=$(DEBUG_TMP)
QUEUE_THRESHOLD?=10
CFLAGS += -DQUEUE_THRESHOLD=$(QUEUE_THRESHOLD)
RANDOMIZE_IPI?=1
CFLAGS += -DRANDOMIZE_IPI=$(RANDOMIZE_IPI)

#FECDebug.h
DEBUG_FEC?=0
CFLAGS+=-DDEBUG_FEC=$(DEBUG_FEC)

#NSFUnreliableBurstDebug.h
DEBUG_UB?=0
CFLAGS+=-DDEBUG_UB=$(DEBUG_UB)

#GPIO debug setup
CFLAGS+=-DTDMA_PIN_DEBUG_ON

#CFLAGS+=-DPORT_FWA_TIMING=P1OUT
#CFLAGS+=-DPIN_FWA_TIMING=BIT3

#CFLAGS+=-DPORT_STATE_TIMING_CAP=P1OUT
#CFLAGS+=-DPIN_STATE_TIMING_CAP=BIT4

#defining these vars will enable the debug code.
#CFLAGS+=-DPORT_IS_TX=P1OUT
#CFLAGS+=-DPIN_IS_TX=BIT3

##low level TX timings
#CFLAGS +=-DPORT_FS_STROBE=P1OUT
#CFLAGS +=-DPIN_FS_STROBE=BIT3

#CFLAGS +=-DPORT_STROBE=P1OUT
#CFLAGS +=-DPIN_STROBE=BIT1

#CFLAGS +=-DPORT_GETPACKET=P1OUT
#CFLAGS +=-DPIN_GETPACKET=BIT4

#CFLAGS +=-DPORT_LOADFIFO=P2OUT
#CFLAGS +=-DPIN_LOADFIFO=BIT4

#CFLAGS +=-DPORT_SF_GPO=P1OUT
#CFLAGS +=-DPIN_SF_GPO=BIT1

#CFLAGS +=-DPORT_SF_GPF=P1OUT
#CFLAGS +=-DPIN_SF_GPF=BIT4

#CFLAGS +=-DPORT_F_GPO=P1OUT
#CFLAGS +=-DPIN_F_GPO=BIT1

#CFLAGS +=-DPORT_F_GPF=P1OUT
#CFLAGS +=-DPIN_F_GPF=BIT4

#CFLAGS +=-DPORT_GP=P1OUT
#CFLAGS +=-DPIN_GP=BIT1

CFLAGS +=-DPORT_FS_CYCLE=P1OUT
CFLAGS +=-DPIN_FS_CYCLE=BIT4

#CFLAGS +=-DPORT_PFS_CYCLE=P1OUT
#CFLAGS +=-DPIN_PFS_CYCLE=BIT1

#CFLAGS +=-DPORT_TXCP_TIMING=P1OUT
#CFLAGS +=-DPIN_TXCP_TIMING=BIT4

#CFLAGS +=-DPORT_TX_TIMING=P1OUT
#CFLAGS +=-DPIN_TX_TIMING=BIT4

#CFLAGS +=-DPORT_FS_TIMING=P1OUT
#CFLAGS +=-DPIN_FS_TIMING=BIT4

CFLAGS +=-DPORT_PFS_TIMING=P1OUT
CFLAGS +=-DPIN_PFS_TIMING=BIT1

#CFLAGS +=-DPORT_SC_TIMING=P2OUT
#CFLAGS +=-DPIN_SC_TIMING=BIT4

#CFLAGS +=-DPORT_FW_TIMING=P1OUT
#CFLAGS +=-DPIN_FW_TIMING=BIT4

#CFLAGS +=-DPORT_SS_TIMING=P1OUT
#CFLAGS +=-DPIN_SS_TIMING=BIT4

#CFLAGS +=-DPORT_SYNCH=P1OUT
#CFLAGS +=-DPIN_SYNCH=BIT1

#CFLAGS+=-DPORT_FLOOD_ATOMIC=P1OUT
#CFLAGS+=-DPIN_FLOOD_ATOMIC=BIT3

#CFLAGS+=-DPORT_HPL_ATOMIC=P1OUT
#CFLAGS+=-DPIN_HPL_ATOMIC=BIT3

#CFLAGS+=-DPORT_RESYNCH=P1OUT
#CFLAGS+=-DPIN_RESYNCH=BIT3

#Timing multipliers etc.
DEBUG_SCALE?=1UL
CFLAGS += -DDEBUG_SCALE=$(DEBUG_SCALE)

#16mhz mclk, 32 mhz dco
PFLAGS+=-DMSP430XV2_DCO_CONFIG=MSP430XV2_DCO_32MHz_RSEL6

CFLAGS+=-DXT2_SMCLK

TA_DIV?=1UL
CFLAGS+=-DTA_DIV=$(TA_DIV)

include $(MAKERULES)
